{
  "task": "step2_whiff_vs_contact",
  "data_path": "data\\processed\\statcast_2023_step2_whiff_contact.parquet",
  "n_rows_total": 327804,
  "splits": {
    "train_rows": 209794,
    "val_rows": 52449,
    "test_rows": 65561,
    "test_size": 0.2,
    "val_size_within_train": 0.2,
    "random_state": 42,
    "stratify": true
  },
  "labels": {
    "positive_class": "whiff(1)",
    "negative_class": "contact(0)",
    "y_distribution": {
      "0": 0.7579895303290991,
      "1": 0.2420104696709009
    }
  },
  "features": {
    "feature_cols_pre_onehot": [
      "effective_speed",
      "release_spin_rate",
      "pfx_z",
      "plate_z",
      "p_throws",
      "stand",
      "sz_bot",
      "sz_top",
      "balls",
      "strikes",
      "outs_when_up",
      "release_extension",
      "release_pos_y",
      "spin_axis",
      "vx0",
      "vy0",
      "vz0",
      "ax",
      "ay",
      "az",
      "plate_x_batter",
      "release_pos_x_batter",
      "release_pos_z_batter",
      "same_side",
      "pfx_x_norm",
      "count_state",
      "two_strikes",
      "in_zone",
      "x_out_mag",
      "x_out_signed_batter",
      "z_out_signed",
      "zone_out_dist",
      "zone_height",
      "plate_z_rel",
      "z_out_signed_rel",
      "runner_on_1b",
      "runner_on_2b",
      "runner_on_3b",
      "any_runner_on",
      "risp",
      "bases_loaded",
      "batting_score_diff",
      "score_bucket"
    ],
    "categorical_cols": [
      "p_throws",
      "stand",
      "count_state",
      "score_bucket"
    ],
    "numeric_cols": [
      "effective_speed",
      "release_spin_rate",
      "pfx_z",
      "plate_z",
      "sz_bot",
      "sz_top",
      "balls",
      "strikes",
      "outs_when_up",
      "release_extension",
      "release_pos_y",
      "spin_axis",
      "vx0",
      "vy0",
      "vz0",
      "ax",
      "ay",
      "az",
      "plate_x_batter",
      "release_pos_x_batter",
      "release_pos_z_batter",
      "same_side",
      "pfx_x_norm",
      "two_strikes",
      "in_zone",
      "x_out_mag",
      "x_out_signed_batter",
      "z_out_signed",
      "zone_out_dist",
      "zone_height",
      "plate_z_rel",
      "z_out_signed_rel",
      "runner_on_1b",
      "runner_on_2b",
      "runner_on_3b",
      "any_runner_on",
      "risp",
      "bases_loaded",
      "batting_score_diff"
    ],
    "onehot_categories": {
      "p_throws": [
        "L",
        "R"
      ],
      "stand": [
        "L",
        "R"
      ],
      "count_state": [
        "0-0",
        "0-1",
        "0-2",
        "1-0",
        "1-1",
        "1-2",
        "2-0",
        "2-1",
        "2-2",
        "3-0",
        "3-1",
        "3-2"
      ],
      "score_bucket": [
        "lead_1-2",
        "lead_3-4",
        "lead_5plus",
        "tied",
        "trail_2-1",
        "trail_4-3",
        "trail_5plus"
      ]
    },
    "n_features_after_onehot": 62
  },
  "xgb_params": {
    "objective": "binary:logistic",
    "eval_metric": [
      "logloss",
      "aucpr"
    ],
    "tree_method": "hist",
    "learning_rate": 0.05,
    "max_depth": 6,
    "min_child_weight": 1,
    "subsample": 0.9,
    "colsample_bytree": 0.9,
    "reg_alpha": 0.0,
    "reg_lambda": 1.0,
    "gamma": 0.0,
    "seed": 42,
    "nthread": -1,
    "num_boost_round": 4000,
    "early_stopping_rounds": 150
  },
  "training": {
    "best_iteration": 680,
    "best_val_aucpr": 0.6058155411378958,
    "train_time_seconds": 69.05242371559143,
    "evals_result_tail": {
      "train_logloss_last": 0.3836475737513232,
      "val_logloss_last": 0.44269336475044413,
      "train_aucpr_last": 0.719586721937504,
      "val_aucpr_last": 0.6055290131679295
    }
  },
  "ranking_metrics": {
    "val_pr_auc": 0.6058325555363091,
    "test_pr_auc": 0.602874928752713,
    "val_roc_auc": 0.7830543337124917,
    "test_roc_auc": 0.7811333858584509
  },
  "thresholding": {
    "policy": "recall_at_precision",
    "target_precision": 0.7,
    "target_recall": null,
    "chosen_threshold": 0.4951767325401306,
    "val_point": {
      "threshold": 0.4951767325401306,
      "precision": 0.7000794281175536,
      "recall": 0.34719924367761756,
      "f1": 0.46418790815251737
    },
    "sweep_csv_path": "artifacts\\step2\\threshold_sweep_val.csv"
  },
  "test_metrics_at_threshold": {
    "threshold": 0.4951767325401306,
    "accuracy": 0.805295831363158,
    "logloss": 0.443971102282062,
    "roc_auc": 0.7811333858584509,
    "confusion_matrix": {
      "pred_contact(0)": {
        "true_contact(0)": 47320,
        "true_whiff(1)": 10390
      },
      "pred_whiff(1)": {
        "true_contact(0)": 2375,
        "true_whiff(1)": 5476
      }
    },
    "classification_report_text": "              precision    recall  f1-score   support\n\n           0      0.820     0.952     0.881     49695\n           1      0.697     0.345     0.462     15866\n\n    accuracy                          0.805     65561\n   macro avg      0.759     0.649     0.671     65561\nweighted avg      0.790     0.805     0.780     65561\n"
  },
  "references": {
    "step1_metrics_path": "artifacts\\step1\\run_metrics.json",
    "step1_booster_path": "artifacts\\step1\\xgb_step1_booster.json",
    "step1_metrics_loaded": true,
    "step1_metrics_snapshot": {
      "data_path": "data\\processed\\statcast_2023_step1_swing_take.parquet",
      "model_path": "artifacts\\step1\\xgb_step1_booster.json",
      "random_state": 42,
      "test_size": 0.2,
      "val_size_within_train": 0.2,
      "early_stopping_rounds": 50,
      "num_boost_round": 2000,
      "best_iteration_used": 600,
      "accuracy": 0.8013372839647886,
      "logloss": 0.41661151093715354,
      "roc_auc": 0.8882453892822346,
      "n_train": 446036,
      "n_val": 111509,
      "n_test": 139387,
      "categorical_cols": [
        "p_throws",
        "stand",
        "count_state",
        "score_bucket"
      ],
      "numeric_cols_count": 39,
      "params": {
        "objective": "binary:logistic",
        "eval_metric": "logloss",
        "tree_method": "hist",
        "eta": 0.05,
        "max_depth": 6,
        "min_child_weight": 1,
        "subsample": 0.9,
        "colsample_bytree": 0.9,
        "lambda": 1.0,
        "alpha": 0.0,
        "gamma": 0.0,
        "seed": 42,
        "verbosity": 1
      }
    }
  }
}